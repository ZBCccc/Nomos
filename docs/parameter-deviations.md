# Parameter Deviations - 参数偏离记录

本文档记录所有与论文 Bag et al. 2024 不一致的实现细节。

## 当前偏离项

### 1. 交叉标签数量 ℓ = 3

**论文描述**: 论文中未明确指定 ℓ 的具体数值,仅在安全性分析中讨论了 ℓ 对假阳性率的影响。

**当前实现**: `ℓ = 3` (在 `nomos/types.hpp` 中定义)

**偏离原因**:
- 论文实验部分未给出具体参数设置
- 参考了类似方案 (如 ODXT) 的典型设置
- ℓ=3 在安全性和性能之间提供了合理的平衡

**影响分析**:
- 安全性: ℓ 越大,假阳性率越低,隐私保护越强
- 性能: ℓ 越大,存储和通信开销越大
- ℓ=3 是一个保守的选择,可以在后续实验中调整

**论文依据**: 论文 Section 5.2 讨论了 ℓ 对安全性的影响,但未给出推荐值。

---

### 2. 采样数量 k = 2

**论文描述**: 论文中未明确指定查询时采样的交叉标签数量 k。

**当前实现**: `k = 2` (在搜索协议中使用)

**偏离原因**:
- 论文未给出具体参数
- k=2 可以有效过滤假阳性,同时保持较低的计算开销
- 满足 k ≤ ℓ 的约束

**影响分析**:
- 安全性: k 越大,查询令牌泄露的信息越多
- 性能: k 越大,服务器端过滤开销越大
- 准确性: k 越大,假阳性率越低

**论文依据**: 论文中提到了交叉标签的采样机制,但未指定 k 的具体值。

---

### 3. C++11 标准 (而非 C++20)

**论文描述**: 论文未指定实现语言或标准。

**当前实现**: 使用 C++11 标准

**偏离原因**:
- 兼容性考虑 (RELIC 库在某些平台上对 C++20 支持不完善)
- C++11 提供了足够的语言特性来实现论文协议
- 降低了依赖环境的要求

**影响分析**:
- 无安全性影响
- 代码可读性略有下降 (无法使用 C++17/20 的便利特性)
- 提高了可移植性

**论文依据**: 论文是语言无关的协议描述,实现语言选择不影响协议正确性。

---

### 4. QTree 容量 = 1024

**论文描述**: 论文中提到了可验证扩展,但未详细描述 Merkle Hash Tree 的具体参数。

**当前实现**: QTree 容量设置为 1024 个叶节点

**偏离原因**:
- 论文未给出 MHT 的容量设置
- 1024 是 2 的幂次,便于索引计算
- 对于原型实现,1024 提供了足够的容量

**影响分析**:
- 性能: 树高为 10,验证路径长度为 10 个哈希值
- 可扩展性: 如果需要更大容量,可以动态扩展或使用多棵树
- 存储: 每个证明约 320 字节 (10 × 32 字节)

**论文依据**: 论文中未详细描述可验证扩展的参数设置。

---

### 5. 哈希函数选择

**论文描述**: 论文中使用抽象的哈希函数 H, F (PRF)。

**当前实现**:
- PRF: 基于 HMAC-SHA256
- 哈希到曲线点: SHA256/SHA384 + hash-to-curve
- 承诺: SHA256

**偏离原因**:
- 论文未指定具体的哈希函数实现
- SHA256 是工业标准,安全性经过充分验证
- RELIC 库提供了 hash-to-curve 的标准实现

**影响分析**:
- 安全性: SHA256 提供 128-bit 安全级别,符合论文的 λ=128 设置
- 性能: SHA256 在现代 CPU 上有硬件加速
- 兼容性: 标准化的哈希函数便于与其他系统互操作

**论文依据**: 论文 Section 3.1 定义了抽象的哈希函数,未指定具体实现。

---

### 6. 椭圆曲线选择

**论文描述**: 论文中使用抽象的配对群 (G1, G2, GT)。

**当前实现**: 使用 RELIC 默认曲线 (BN254 或 BLS12-381)

**偏离原因**:
- 论文未指定具体的椭圆曲线
- BN254 和 BLS12-381 是配对友好曲线的标准选择
- RELIC 库对这些曲线有优化实现

**影响分析**:
- 安全性: 两种曲线都提供 128-bit 安全级别
- 性能: BN254 速度更快,BLS12-381 安全边际更大
- 兼容性: 两种曲线都是工业标准

**论文依据**: 论文 Section 3.1 定义了抽象的配对群,未指定具体曲线。

---

## 待确认的实现细节

以下实现细节需要进一步与论文对照确认:

### 1. UpdateCnt 计数器的初始化和更新逻辑
- 论文: Section 4.2 描述了更新协议
- 当前实现: 需要验证计数器的递增时机是否与论文一致

### 2. TSet 和 XSet 的存储结构
- 论文: 使用抽象的字典结构
- 当前实现: 使用 `std::unordered_map`
- 需要确认: 是否需要持久化存储?

### 3. 搜索结果的解密和过滤逻辑
- 论文: Section 4.3 描述了搜索协议
- 当前实现: 需要验证客户端解密后的过滤逻辑

### 4. 删除操作的实现
- 论文: 支持动态删除
- 当前实现: 删除操作的具体实现需要与论文对照

---

## 更新日志

- **2026-02-28**: 初始版本,记录当前已知的参数偏离
- 待补充: 在实现过程中发现的新偏离项
